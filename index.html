<script>
  const PIN = "1234";
  let keyCount = parseInt(localStorage.getItem("keyCount") || "0");
  let keyLog = JSON.parse(localStorage.getItem("keyLog") || "[]");

  document.addEventListener("keydown", (e) => {
    keyCount++;
    const logEntry = {
      key: e.key,
      time: new Date().toISOString()
    };
    keyLog.push(logEntry);
    localStorage.setItem("keyCount", keyCount);
    localStorage.setItem("keyLog", JSON.stringify(keyLog));
    const list = document.getElementById("keyLog");
    if (list) {
      const li = document.createElement("li");
      li.textContent = `${logEntry.time} — ${logEntry.key}`;
      list.appendChild(li);
    }
  });

  function unlock() {
    const inputPin = document.getElementById("pinInput").value;
    if (inputPin === PIN) {
      document.getElementById("login").style.display = "none";
      document.getElementById("secureArea").style.display = "block";
      document.getElementById("keyCount").textContent = keyCount;
      loadKeyLog();
    } else {
      document.getElementById("loginStatus").textContent = "❌ Incorrect PIN";
    }
  }

  function resetCount() {
    keyCount = 0;
    keyLog = [];
    localStorage.setItem("keyCount", 0);
    localStorage.setItem("keyLog", "[]");
    document.getElementById("keyCount").textContent = "0";
    document.getElementById("keyLog").innerHTML = "";
  }

  function lock() {
    document.getElementById("secureArea").style.display = "none";
    document.getElementById("login").style.display = "block";
    document.getElementById("loginStatus").textContent = "";
    document.getElementById("pinInput").value = "";
  }

  function loadKeyLog() {
    const list = document.getElementById("keyLog");
    list.innerHTML = "";
    keyLog.forEach(entry => {
      const li = document.createElement("li");
      li.textContent = `${entry.time} — ${entry.key}`;
      list.appendChild(li);
    });
  }

  function exportCSV() {
    const csvRows = [["Time", "Key"]];
    keyLog.forEach(({ time, key }) => {
      csvRows.push([time, key]);
    });
    const csv = csvRows.map(row => row.join(",")).join("\n");
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "key_log.csv";
    a.click();
    URL.revokeObjectURL(url);
  }
</script>

</body>
</h
